<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Deploy Services</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.83.1"><meta name=description content="Deploy Services - TeSLA CE "><link rel=stylesheet href=https://tesla-ce.github.io/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://tesla-ce.github.io/plugins/themify-icons/themify-icons.css><link rel=icon href=https://tesla-ce.github.io/images/favicon.png type=image/x-icon><link href="https://fonts.googleapis.com/css?family=Lato:300,400,700&display=swap" rel=stylesheet><style>:root{--primary-color:#02007e;--body-color:#f9f9f9;--text-color:#636363;--text-color-dark:#242738;--white-color:#ffffff;--light-color:#f8f9fa;--font-family:Lato}</style><link href=https://tesla-ce.github.io/css/style.min.css rel=stylesheet media=screen><script src=https://tesla-ce.github.io/plugins/jquery/jquery-1.12.4.js></script><script src=https://tesla-ce.github.io/plugins/jquery/jquery-ui.js></script><script src=https://tesla-ce.github.io/plugins/bootstrap/bootstrap.min.js></script><script src=https://tesla-ce.github.io/plugins/match-height/jquery.matchHeight-min.js></script><meta property="og:image" content="https://tesla-ce.github.io/images/logo_tesla_ce.png"><meta name=twitter:image content="https://tesla-ce.github.io/images/logo_tesla_ce.png"><meta name=twitter:card content="summary_large_image"><meta property="og:image:width" content="1268"><meta property="og:image:height" content="711"><meta property="og:image:type" content="image/png"><meta name=twitter:title content="Deploy Services"><meta name=twitter:description content="Deploy services as part of TeSLA CE installation is not recommended for production. Skip this step if you already have your services deployed.
 Requirements Some services need to be publicly accessible. You will need to create subdomains:
 vault.<domain> storage.<domain> rabbitmq.<domain>  that points to your Docker Swarm cluster.
Generate deployment scripts To generate all scripts to deploy services on your cluster, run:
tesla_ce deploy_services This command will create a folder deploy with:"><meta property="og:title" content="Deploy Services"><meta property="og:description" content="Deploy services as part of TeSLA CE installation is not recommended for production. Skip this step if you already have your services deployed.
 Requirements Some services need to be publicly accessible. You will need to create subdomains:
 vault.<domain> storage.<domain> rabbitmq.<domain>  that points to your Docker Swarm cluster.
Generate deployment scripts To generate all scripts to deploy services on your cluster, run:
tesla_ce deploy_services This command will create a folder deploy with:"><meta property="og:type" content="article"><meta property="og:url" content="https://tesla-ce.github.io/installation/install/swarm/services/"><meta property="article:section" content="installation"><meta property="article:modified_time" content="2021-06-14T18:23:20+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Deploy Services"><meta name=twitter:description content="Deploy services as part of TeSLA CE installation is not recommended for production. Skip this step if you already have your services deployed.
 Requirements Some services need to be publicly accessible. You will need to create subdomains:
 vault.<domain> storage.<domain> rabbitmq.<domain>  that points to your Docker Swarm cluster.
Generate deployment scripts To generate all scripts to deploy services on your cluster, run:
tesla_ce deploy_services This command will create a folder deploy with:"></head><body><header class="shadow-bottom sticky-top bg-white"><nav class="navbar navbar-expand-md navbar-light"><div class=container><a class="navbar-brand px-2" href=/><img class=img-fluid src=https://tesla-ce.github.io/images/logo_black.png alt="TeSLA CE"></a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation aria-controls=navigation aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav ml-auto"><li class=nav-item><a class="nav-link text-dark" href=https://tesla-ce.github.io/>Home</a></li><li class=nav-item><a class="nav-link text-dark" href=https://tesla-ce.github.io/faq>Faq</a></li><li class=nav-item><a class="nav-link text-dark" href=https://tesla-ce.github.io/contact>contact</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle text-dark" href=# role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>docs</a><div class=dropdown-menu><a class=dropdown-item href=https://tesla-ce.github.io/features>Features</a>
<a class=dropdown-item href=https://tesla-ce.github.io/installation>Installation</a>
<a class=dropdown-item href=https://tesla-ce.github.io/developers>Developers</a></div></li></ul></div></div></nav></header><section class="single section-sm pb-0"><div class=container><div class=row><div class=col-lg-3><div class=sidebar><a class=back-btn href=/ aria-label=back></a><ul class=list-styled><li data-nav-id=https://tesla-ce.github.io/installation/ title=Installation class=sidelist><a href=https://tesla-ce.github.io/installation/>Installation</a><ul><li data-nav-id=https://tesla-ce.github.io/installation/requirements/ title=Requirements class=sidelist><a href=https://tesla-ce.github.io/installation/requirements/>Requirements</a></li><li data-nav-id=https://tesla-ce.github.io/installation/install/ title=Installation class=sidelist><a href=https://tesla-ce.github.io/installation/install/>Installation</a><ul><li data-nav-id=https://tesla-ce.github.io/installation/install/swarm/ title="Docker Swarm" class=sidelist><a href=https://tesla-ce.github.io/installation/install/swarm/>Docker Swarm</a><ul><li data-nav-id=https://tesla-ce.github.io/installation/install/swarm/requirements/ title=Requirements class=sidelist><a href=https://tesla-ce.github.io/installation/install/swarm/requirements/>Requirements</a></li><li data-nav-id=https://tesla-ce.github.io/installation/install/swarm/getting_started/ title="Getting Started" class=sidelist><a href=https://tesla-ce.github.io/installation/install/swarm/getting_started/>Getting Started</a></li><li data-nav-id=https://tesla-ce.github.io/installation/install/swarm/configuration/ title=Configuration class=sidelist><a href=https://tesla-ce.github.io/installation/install/swarm/configuration/>Configuration</a></li><li data-nav-id=https://tesla-ce.github.io/installation/install/swarm/services/ title="Deploy Services" class="sidelist
active"><a href=https://tesla-ce.github.io/installation/install/swarm/services/>Deploy Services</a></li><li data-nav-id=https://tesla-ce.github.io/installation/install/swarm/initialize/ title=Initialize class=sidelist><a href=https://tesla-ce.github.io/installation/install/swarm/initialize/>Initialize</a></li><li data-nav-id=https://tesla-ce.github.io/installation/install/swarm/core/ title="Deploy TeSLA CE" class=sidelist><a href=https://tesla-ce.github.io/installation/install/swarm/core/>Deploy TeSLA CE</a></li></ul></li><li data-nav-id=https://tesla-ce.github.io/installation/install/docker-compose/ title=Docker-Compose class=sidelist><a href=https://tesla-ce.github.io/installation/install/docker-compose/>Docker-Compose</a></li></ul></li><li data-nav-id=https://tesla-ce.github.io/installation/configuration/ title=Configuration class=sidelist><a href=https://tesla-ce.github.io/installation/configuration/>Configuration</a></li><li data-nav-id=https://tesla-ce.github.io/installation/customization/ title=Customization class=sidelist><a href=https://tesla-ce.github.io/installation/customization/>Customization</a></li><li data-nav-id=https://tesla-ce.github.io/installation/elements/ title=Elements class=sidelist><a href=https://tesla-ce.github.io/installation/elements/>Elements</a></li></ul></li></ul></div></div><div class=col-lg-9><div class="p-lg-5 p-4 bg-white"><h2 class=mb-5>Deploy Services</h2><div class=content><div class="notices warning"><p>Deploy services as part of TeSLA CE installation is not recommended for production.
Skip this step if you already have your services deployed.</p></div><h2 id=requirements>Requirements</h2><p>Some services need to be publicly accessible. You will need to create subdomains:</p><ul><li>vault.&lt;domain></li><li>storage.&lt;domain></li><li>rabbitmq.&lt;domain></li></ul><p>that points to your Docker Swarm cluster.</p><h2 id=generate-deployment-scripts>Generate deployment scripts</h2><p>To generate all scripts to deploy services on your cluster, run:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>tesla_ce deploy_services</code></pre></div><p>This command will create a folder <strong>deploy</strong> with:</p><ul><li><strong>config</strong>: Folder with required configuration files</li><li><strong>secrets</strong>: Folder with required secret files</li><li><strong>tesla_lb.yml</strong>: Docker Stack file for the Load Balancer</li><li><strong>tesla_services.yml</strong>: Docker Stack file to deploy all services</li></ul><h2 id=deploy-services>Deploy services</h2><p>Before deploying, move <strong>deploy</strong> folder to a Docker Swarm master node and <strong>move to this folder</strong> of the node machine.</p><h3 id=create-networks>Create networks</h3><p>TeSLA CE will use two different networks, to create them run:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker network create --driver overlay tesla_public
docker network create --driver overlay tesla_private</code></pre></div><h3 id=create-persistent-data-folders>Create persistent data folders</h3><p>To provide persistence of the data, all services will be provided with a mounted volume.
All data folders are created under the folder provided in the <strong>deployment_data_path</strong> configuration option (see <a href=../configuration>Configuration</a>).
By default, this folder is <code>/var/tesla</code>.</p><p>Traefik is used as a default load balancer and certificate management. We need to create a persistence folder for traefik:<br><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo mkdir -p /var/tesla/traefik</code></pre></div></p><p>In the same way, all services will have their own persistence folder. We need to create a folder for each service:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo mkdir -p /var/tesla/db
sudo mkdir -p /var/tesla/rabbitmq
sudo mkdir -p /var/tesla/redis
sudo mkdir -p /var/tesla/minio</code></pre></div></p><h3 id=deploy-services-to-docker-swarm-cluster>Deploy services to Docker Swarm cluster</h3><p>Finally, we are ready to deploy all services to the cluster. We need to start by deploying the load balancer:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker stack deploy -c tesla_lb.yml tesla</code></pre></div><p>You can check the deployment progress with:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>watch docker service ls</code></pre></div><p>Once Traefik service is up, we can deploy the rest of the services:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker stack deploy -c tesla_services.yml tesla</code></pre></div><h2 id=additional-dns-entries>Additional DNS entries</h2><p>Some of the deployed services requires external access through the load balancer. You will need to define
the following subdomains pointing to the cluster:</p><ul><li>vault.&lt;domain></li><li>storage.&lt;domain></li><li>rabbitmq.&lt;domain></li></ul><p>The rest of the services open their ports on the cluster, and are accessible directly on the cluster address pointed by
&lt;domain>.</p><h3 id=working-with-not-public-domains>Working with not public domains</h3><p>TeSLA CE assumes that provided &lt;domain> is a valid domain configured in a public DNS. In the case you are using a not
valid domain, you should perform some extra actions (assuming that <strong>V.X.Y.Z</strong> is the IP of the machine):</p><ol><li>Add entries for &lt;domain> and subdomains on the installation computer local hosts <code>/etc/hosts</code>:</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>V.X.Y.Z &lt;domain&gt;
V.X.Y.Z vault.&lt;domain&gt;
V.X.Y.Z storage.&lt;domain&gt;
V.X.Y.Z rabbitmq.&lt;domain&gt;</code></pre></div><ol start=2><li><p>Add an extra hosts option to your services, so they can resolve the domain names:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>   <span style=color:#f92672>extra_hosts</span>:      
      <span style=color:#f92672>V.X.Y.Z</span>: <span style=color:#ae81ff>&lt;domain&gt;</span>
      <span style=color:#f92672>V.X.Y.Z</span>: <span style=color:#ae81ff>vault.&lt;domain&gt;</span>
      <span style=color:#f92672>V.X.Y.Z</span>: <span style=color:#ae81ff>storage.&lt;domain&gt;</span>
      <span style=color:#f92672>V.X.Y.Z</span>: <span style=color:#ae81ff>rabbitmq.&lt;domain&gt;</span></code></pre></div></p></li><li><p>As traefik will not be able to generate valid certificates, you will need to <strong>disable the SSL check</strong> options on the
configuration file (storage and vault sections).</p></li></ol></div><p class="post-meta border-bottom pb-3 mb-0 mt-3">Updated on 14 Jun 2021</p><nav class="pagination mt-3"><a class="nav nav-prev" href=https://tesla-ce.github.io/installation/install/swarm/configuration/ aria-label="Previous page"><i class="ti-arrow-left mr-2"></i> <span class="d-none d-md-block">Configuration</span></a>
<a class="nav nav-next" href=https://tesla-ce.github.io/installation/install/swarm/initialize/ aria-label="Previous page"><span class="d-none d-md-block">Initialize</span><i class="ti-arrow-right ml-2"></i></a></nav></div></div></div></div></section><footer class="section pb-4"><div class=container><div class="row align-items-center"><div class="col-md-8 text-md-left text-center"><p class="mb-md-0 mb-4">Copyright © 2021 TeSLA CE</p></div><div class="col-md-4 text-md-right text-center"><ul class=list-inline><li class=list-inline-item><a class="text-color d-inline-block p-2" href=https://github.com/tesla-ce aria-label=Github><i class=ti-github></i></a></li></ul></div></div></div></footer><script src=https://tesla-ce.github.io/js/script.min.js></script></body></html>